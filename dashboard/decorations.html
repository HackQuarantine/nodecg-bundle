<!DOCTYPE html>
<html>
<body>
    <label>On now:</label>
    <input id="on_now_name" type="text"></input>
    <input id="on_now_person" type="text"></input>
    <input id="on_now_time" type="text"></input>
    <button id="on_now_submit">Submit</button>

    <br/>

    <label>Up next:</label>
    <div id="up_nexts">
        <div class="up_next">
            <input class="up_next_name" type="text"></input>
            <input class="up_next_person" type="text"></input>
            <input class="up_next_time" type="text"></input>
            <button class="up_next_remove" onclick="removeRow(this);">Remove Row</input>
            <button class="up_next_up" onclick="moveUp(this);">Up</input>
            <button class="up_next_down" onclick="moveDown(this);">Down</input>
        </div>
    </div>
    <button id="up_next_add">Add Row</button>
    <button id="up_next_submit">Submit</button>

    <br />

    <label>Text:</label>
    <input id="text_image" type="text"></input>
    <input id="text_contents" type="text"></input>
    <button id="text_submit">Submit</button>
</body>

<script>
    const row_html = `
        <input class="up_next_name" type="text"></input>
        <input class="up_next_person" type="text"></input>
        <input class="up_next_time" type="text"></input>
        <button class="up_next_remove" onclick="removeRow(this);">Remove Row</input>
        <button class="up_next_up" onclick="moveUp(this);">Up</input>
        <button class="up_next_down" onclick="moveDown(this);">Down</input>`

    function removeRow(button) {
        button.parentNode.remove();
    }

    function moveUp(button) {
        element = button.parentNode;
        if(element.previousElementSibling) {
            element.parentNode.insertBefore(element, element.previousElementSibling);
        }
    }

    function moveDown(button) {
        element = button.parentNode;
        if(element.nextElementSibling) {
            element.parentNode.insertBefore(element.nextElementSibling, element);
        }
    }

    const add_row = document.getElementById("up_next_add");
    add_row.addEventListener("click", function() {
        var node = document.createElement("div");
        node.classList.add("up_next");
        node.innerHTML = row_html;
        document.getElementById("up_nexts").appendChild(node);
    });

    // ***************
    // * SUBMIT CODE *
    // ***************

    const on_now_replicant = nodecg.Replicant("on_now");
    const up_next_replicant = nodecg.Replicant("up_next");
    const stats_replicant = nodecg.Replicant("stats");

    document.getElementById("on_now_submit").onclick = () => {
        on_now_replicant.value = {
            'name': document.getElementById("on_now_name").value,
            'person': document.getElementById("on_now_person").value,
            'time': document.getElementById("on_now_time").value
        };
    }

    document.getElementById("up_next_submit").onclick = () => {
        events = [];
        elements = document.getElementById("up_nexts").getElementsByClassName("up_next");
        for (var i = 0; i < elements.length; i++) {
            e = {};
            e.name = elements[i].getElementsByClassName("up_next_name")[0].value;
            e.person = elements[i].getElementsByClassName("up_next_person")[0].value;
            e.time = elements[i].getElementsByClassName("up_next_time")[0].value;
            events.push(e);
        }
        up_next_replicant.value = events;
    }

    document.getElementById("text_submit").onclick = () => {
        stats_replicant.value = {
            'image': document.getElementById("text_image").value,
            'text': document.getElementById("text_contents").value
        }
    }
</script>
</html>
